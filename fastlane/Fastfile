lane :bump_version do |options|
  puts "Bumping with parts: #{options[:parts]}"
  result = flutter_bump_version(
    bump_build: options[:bump_build],
    parts: options[:parts],
    pubspec: "./pubspec.yaml"
  )

  if options[:push] || options[:parts]
    sh "git config --global user.email kiyochinh@gmail.com"
    sh "git config --global user.name Kiyo Chinh"
    sh "git config --global push.followTags true"
    sh "git add ../pubspec.yaml"  # Adjusted path
    sh "git commit -m '[Chore] Bump version from #{result[:previous]} to #{result[:new]}'"
    sh "git tag -a v#{result[:new].gsub('+', '.')} -m 'Version #{result[:new].gsub('+', '.')}'"
    sh "git pull --rebase origin #{options[:branch]}"
    sh "python build-system/push_changes.py \"${{ secrets.REPO_TOKEN }}\" \"${{ github.repository }}\" \"#{options[:branch]}\""
  end
end